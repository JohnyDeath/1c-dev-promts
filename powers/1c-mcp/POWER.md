---
name: "1c-mcp"
displayName: "1С:Предприятие MCP"
description: "MCP сервер для работы с базой данных 1С:Предприятие. Используй этот навык когда нужно получить данные из 1С, выполнить анализ данных в базе 1С, изучить структуру метаданных или написать запрос на языке 1С."
keywords: ["1с", "1c", "предприятие", "enterprise", "база данных", "запрос", "метаданные"]
author: "Мартыненков Е.В."
---

# MCP сервер 1С:Предприятие

## Обзор

MCP сервер для работы с базой данных 1С:Предприятие через HTTP-сервис. Позволяет:
- Выполнять запросы к базе данных на языке 1С
- Исследовать структуру метаданных конфигурации
- Получать описания объектов (реквизиты, табличные части)
- Работать с навигационными ссылками 1С

**Всегда начинай с `list_metadata_objects` если не знаешь точное имя объекта.**

## Рекомендуемый порядок работы

```
1. list_metadata_objects    → найти нужные объекты по имени
2. get_metadata_structure   → изучить структуру объекта
3. validate_query           → проверить синтаксис (опционально)
4. execute_query            → получить данные
5. get_nav_link             → создать ссылку для открытия в 1С
```

---

## Инструменты (Tools)

### 1. list_metadata_objects — Разведка конфигурации

**Назначение:** Поиск объектов метаданных по типу и имени. Используй ПЕРЕД любыми запросами когда не знаешь точное имя объекта.

**Параметры:**

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| metaType | string | ✅ | Тип объекта метаданных |
| nameMask | string | ❌ | Фильтр по имени/синониму (регистронезависимый) |
| maxItems | number | ❌ | Макс. результатов (по умолчанию 100) |

**Поддерживаемые metaType:**
- `Catalogs` — справочники
- `Documents` — документы
- `InformationRegisters` — регистры сведений
- `AccumulationRegisters` — регистры накопления
- `AccountingRegisters` — регистры бухгалтерии
- `Enums` — перечисления

**Пример:**
```json
{
  "metaType": "Documents",
  "nameMask": "реализ",
  "maxItems": 100
}
```

---

### 2. get_metadata_structure — Изучение структуры объекта

**Назначение:** Получение полного описания структуры объекта: реквизиты, табличные части, типы данных. Используй когда нужно узнать какие поля доступны у объекта.

**Параметры:**

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| metaType | string | ✅ | Тип объекта (Documents, Catalogs и др.) |
| name | string | ✅ | Имя объекта БЕЗ префикса типа |

**Пример:**
```json
{
  "metaType": "Documents",
  "name": "РеализацияТоваровУслуг"
}
```

---

### 3. validate_query — Проверка синтаксиса запроса

**Назначение:** Проверка синтаксиса запроса 1С БЕЗ выполнения и БЕЗ обращения к базе данных. Быстрая операция — только парсинг текста.

**Параметры:**

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| queryText | string | ✅ | Текст запроса 1С для проверки |

---

### 4. execute_query — Основной инструмент

**Назначение:** ОСНОВНОЙ ИНСТРУМЕНТ для получения данных из 1С. Выполняет запрос и возвращает данные с автоматической обработкой ссылочных типов.

**Особенности:**
- Ссылочные поля автоматически конвертируются в объекты с `_objectRef: true`
- Результаты можно использовать как параметры для следующих запросов
- Можно организовывать цепочки запросов для углубления по связям

**Параметры:**

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| queryText | string | ✅ | Текст запроса на языке 1С |
| parameters | object | ❌ | Параметры запроса (объектные описания) |
| limit | number | ❌ | Ограничение строк (по умолчанию 100, максимум 1000) |

**Важные ограничения:**

❌ **НЕПРАВИЛЬНО** — использование параметров через `&`:
```sql
ГДЕ Товар = &Товар
```

✅ **ПРАВИЛЬНО** — значения явно:
```sql
ГДЕ Контрагент.Наименование = "ООО Ромашка"
ГДЕ Товар.Код = "000001"
```

✅ **ПРАВИЛЬНО** — использование описаний объекта:
```json
{
  "queryText": "ВЫБРАТЬ * ИЗ Документ.РеализацияТоваровУслуг ГДЕ Контрагент = &Контрагент",
  "parameters": {
    "Контрагент": {
      "_objectRef": true,
      "УникальныйИдентификатор": "9e6f1a6b-...",
      "ТипОбъекта": "СправочникСсылка.Контрагенты"
    }
  }
}
```

---

### 5. parse_nav_link — Парсинг навигационной ссылки

**Назначение:** Преобразует навигационную ссылку 1С (e1cib/data/...) в описание объекта. Используй когда пользователь присылает ссылку из 1С.

**Параметры:**

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| navLink | string | ✅ | Навигационная ссылка формата `e1cib/data/...` |

---

### 6. get_nav_link — Получение навигационной ссылки

**Назначение:** Получает навигационную ссылку по описанию объекта. Используй чтобы дать пользователю кликабельную ссылку для открытия в 1С.

**Параметры:**

| Параметр | Тип | Обязательный | Описание |
|----------|-----|--------------|----------|
| objectDescription | object | ✅ | Описание объекта с `_objectRef`, `УникальныйИдентификатор`, `ТипОбъекта` |

---

## Ресурсы (Resources)

### 1csyntax — Справочник синтаксиса 1С

- **URI:** `file://resource/syntax_1c.txt`
- **Описание:** Описание синтаксиса встроенного языка 1С:Предприятие в формате Markdown

---

## Синтаксис запросов 1С

### Базовая структура

```sql
ВЫБРАТЬ [РАЗЛИЧНЫЕ] [ПЕРВЫЕ N]
    <Поля выборки>
ИЗ
    <Источники данных>
[ГДЕ
    <Условия отбора>]
[СГРУППИРОВАТЬ ПО
    <Поля группировки>]
[УПОРЯДОЧИТЬ ПО
    <Поля сортировки>]
```

### Основные источники данных

| Тип объекта | Синтаксис |
|-------------|-----------|
| Справочник | `Справочник.ИмяСправочника` |
| Документ | `Документ.ИмяДокумента` |
| Табличная часть | `Документ.ИмяДокумента.ИмяТабличнойЧасти` |
| Регистр накопления (остатки) | `РегистрНакопления.ИмяРегистра.Остатки()` |
| Регистр накопления (обороты) | `РегистрНакопления.ИмяРегистра.Обороты()` |
| Регистр сведений | `РегистрСведений.ИмяРегистра` |
| Регистр сведений (срез последних) | `РегистрСведений.ИмяРегистра.СрезПоследних()` |

### Суффиксы ресурсов регистра накопления

| Таблица | Суффикс | Пример |
|--------|---------|--------|
| Остатки() | `Остаток` | `КоличествоОстаток` |
| ОстаткиИОбороты() | `НачальныйОстаток`, `Приход`, `Расход`, `КонечныйОстаток` | `КоличествоКонечныйОстаток` |
| Обороты() | `Приход`, `Расход`, `Оборот` | `КоличествоПриход` |

---

## Работа с датами

**Функция ДАТАВРЕМЯ:**
```sql
ДАТАВРЕМЯ(Год, Месяц, День[, Час, Минута, Секунда])
```

```sql
ГДЕ Документы.Дата >= ДАТАВРЕМЯ(2026, 1, 1)
ДАТАВРЕМЯ(2026, 1, 1, 12, 30, 0)  -- с точностью до секунд
```

**Функции дат:**

| Функция | Описание | Пример |
|---------|----------|--------|
| `ГОД()` | Год из даты | `ГОД(Дата)` |
| `КВАРТАЛ()` | Квартал | `КВАРТАЛ(Дата)` |
| `МЕСЯЦ()` | Месяц | `МЕСЯЦ(Дата)` |
| `ДЕНЬ()` | День месяца | `ДЕНЬ(Дата)` |
| `НАЧАЛОПЕРИОДА()` | Начало периода | `НАЧАЛОПЕРИОДА(Дата, МЕСЯЦ)` |
| `КОНЕЦПЕРИОДА()` | Конец периода | `КОНЕЦПЕРИОДА(Дата, МЕСЯЦ)` |

---

## Работа со строками

**Оператор ПОДОБНО:**
```sql
ГДЕ Наименование ПОДОБНО "%телефон%"     -- содержит
ГДЕ Код ПОДОБНО "001___"                  -- ровно 3 символа после 001
```

- `%` — любое количество символов
- `_` — один символ

**Функции строк:**

| Функция | Описание |
|---------|----------|
| `ПОДСТРОКА(Строка, Начало, Длина)` | Часть строки |
| `ДЛИНА(Строка)` | Длина строки |

---

## Агрегатные функции

| Функция | Описание |
|---------|----------|
| `СУММА()` | Сумма значений |
| `КОЛИЧЕСТВО()` | Количество записей |
| `МАКСИМУМ()` | Максимальное значение |
| `МИНИМУМ()` | Минимальное значение |
| `СРЕДНЕЕ()` | Среднее значение |

```sql
ВЫБРАТЬ ПЕРВЫЕ 20
    Продажи.Номенклатура.Наименование КАК Товар,
    СУММА(Продажи.Количество) КАК ВсегоПродано,
    СУММА(Продажи.Сумма) КАК СуммаПродаж
ИЗ
    РегистрНакопления.Продажи.Обороты(
        ДАТАВРЕМЯ(2026, 1, 1),
        ДАТАВРЕМЯ(2026, 1, 31)) КАК Продажи
СГРУППИРОВАТЬ ПО
    Продажи.Номенклатура
```

---

## Условный оператор ВЫБОР

```sql
ВЫБРАТЬ ПЕРВЫЕ 50
    Товары.Наименование,
    ВЫБОР
        КОГДА Товары.ЭтоГруппа = ИСТИНА ТОГДА "Группа"
        ИНАЧЕ "Элемент"
    КОНЕЦ КАК ТипЗаписи
ИЗ
    Справочник.Номенклатура КАК Товары
```

---

## Примеры запросов

### Остатки товаров на складах

```sql
ВЫБРАТЬ ПЕРВЫЕ 100
    Остатки.Номенклатура.Наименование КАК Товар,
    Остатки.Склад.Наименование КАК Склад,
    Остатки.КоличествоОстаток КАК Количество
ИЗ
    РегистрНакопления.ТоварыНаСкладах.Остатки() КАК Остатки
ГДЕ
    Остатки.КоличествоОстаток > 0
УПОРЯДОЧИТЬ ПО
    Товар
```

### Документы за период

```sql
ВЫБРАТЬ ПЕРВЫЕ 50
    Док.Номер,
    Док.Дата,
    Док.Контрагент.Наименование КАК Контрагент,
    Док.СуммаДокумента
ИЗ
    Документ.РеализацияТоваровУслуг КАК Док
ГДЕ
    Док.Дата >= ДАТАВРЕМЯ(2026, 1, 1)
    И Док.Дата < ДАТАВРЕМЯ(2026, 2, 1)
    И Док.Проведен = ИСТИНА
УПОРЯДОЧИТЬ ПО
    Док.Дата УБЫВ
```

### Актуальные цены

```sql
ВЫБРАТЬ ПЕРВЫЕ 100
    Цены.Номенклатура.Наименование КАК Товар,
    Цены.ТипЦен.Наименование КАК ТипЦены,
    Цены.Цена
ИЗ
    РегистрСведений.ЦеныНоменклатуры.СрезПоследних() КАК Цены
УПОРЯДОЧИТЬ ПО
    Товар
```

---

## Типичные ошибки и решения

| Ошибка | Причина | Решение |
|--------|---------|---------|
| "Параметр не найден" | Использование `&ИмяПараметра` | Указывать значения явно |
| Ошибка при сравнении ссылок | Прямое сравнение ссылочных полей | Сравнивать через `.Код`, `.Наименование` |
| Слишком много данных / таймаут | Нет ограничения `ПЕРВЫЕ N` | Всегда использовать `ПЕРВЫЕ N` |
| NULL в вычислениях | Левое соединение без обработки NULL | Использовать `ЕСТЬNULL(Поле, 0)` |

---

## MCP Config Placeholders

**Перед использованием замените плейсхолдеры в `mcp.json`:**

- **`YOUR_1C_SERVER_URL`**: URL вашего HTTP-сервиса 1С
  - Формат: `http://server/base/hs/mcp/`
  - Пример: `http://1c.company.local/erp/hs/mcp/`

- **`YOUR_LOGIN`**: Логин пользователя 1С с правами на HTTP-сервис

- **`YOUR_PASSWORD`**: Пароль пользователя

---

**Протокол:** MCP 2025-03-26 (HTTP SSE)
**Сервер:** 1С:Предприятие HTTP-сервис
